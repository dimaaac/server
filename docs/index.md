# index.js

## Overview
This documentation provides an explanation of index.js.

## Import Statements
- `Dimensions` and `players` are imported from the `./world/index.js` module.
- Prototypes are imported from the `./utils/prototypes.js` module.
- Various constants and functions (`CONFIG`, `HANDLERS`, `STATS`, `DEFAULT_TPS`, `stat`) are imported from the `./config.js` module.
- `setTPS` is imported from the `./world/tick.js` module.
- `close`, `httpServer`, `secure`, and `server` are imported from the `./server.js` module.
- `argv`, `ready`, and `stats` are imported from the `./internals.js` module.
- `util` is imported from the Node.js built-in `util` module.
- `chat` and constants (`LIGHT_GREY`, `ITALIC`) are imported from the `./misc/chat.js` module.
- `commands` and `err` are imported from the `./misc/commands.js` module.
- `Entities` and `entityMap` are imported from the `./entities/entity.js` module.
- `Blocks` are imported from the `./blocks/block.js` module.
- `Items` are imported from the `./items/item.js` module.

## Initialization
- The terminal is cleared using ANSI escape codes.
- The script awaits the `ready` promise to ensure all modules are loaded before proceeding.
- A function `clear()` is defined to clear the terminal.
- A loading message is displayed indicating the server is starting.
- An event listener is set on the `httpServer` for the 'listening' event. Once the server is listening, a message is displayed indicating successful startup along with the server's port information.
- A REPL (Read-Eval-Print Loop) is started for user interaction. Commands can be entered starting with '/', or JavaScript code can be entered directly.
- Another REPL is started for JavaScript evaluation prefixed with '$'.
- The HTTP server starts listening on the provided port (defaulting to 27277 if not specified).
- The Ticks Per Second (TPS) is set to the default value.

## Graceful Shutdown
- A SIGINT signal handler is added to handle graceful shutdown (`SIGINT` is generated by pressing Ctrl+C in the terminal).
- On SIGINT, a shutdown process begins:
  - The server is closed gracefully.
  - A flag `exiting` is set to prevent repeated shutdown actions.
  - Promises are created to handle closing client connections and saving data.
  - Data is saved for all dimensions and statistics.
  - All promises are resolved before exiting the process.
- A timeout function is defined to periodically save data every 5 minutes (300 seconds).
